(function(e,r){"use strict";e.module("ppAssetsTickerStrip",["ppCoreModule"])})(angular,qqA);(function(e,r){"use strict";var t=r.service("logger");var s=r.service("template");var a=r.service("config");var n=r.service("assetResource");var i=r.service("gateway");function o(o){var u=25;var c=1;var l=s.getTplPath("ppAssetsTickerStrip","main");function p(s,l,p){var d=i.connector;var v=true;var f=p.numberOfElements||12;var m;var g={};var A=0;var y;var h="ppAssetsTickerStrip";if(a.embeddable&&a.embeddedWidgetsArr.indexOf(h)>-1&&!s.$parent.isParentEmbeddableDrv){return false}function b(e){var r;if(e.error||!e.hasOwnProperty("data")){return}r=e.data.quotes;if(v){v=false;$(T(r))}else{S(r)}}function P(){r.service("assetQuotes").subscribe(b)}function T(r){var t,s,a;for(var n in g){t=g[n];s=r[t.symbol];if(s){a={mid:s.mid,pctChange:s.pctChange,LAST:e.copy(s.open),TICK_UP:s.mid>=s.open};e.extend(t,a)}}return g}function k(e,r){var t=[];if(!r){t.push('<li class="asset" id="',e.symbol,'">')}if(e.assetName){e.assetName=y.getAssetName(e.symbol)}if(!e.mid){e.mid=""}t.push("<span>","<bdo>",e.assetName,"</bdo>"," ",e.mid," ",'<span class="tick-direction ',e.TICK_UP?"up-tick":"down-tick",'">',"</span> ",(e.pctChange||0).toFixed(2),"%","</span>");if(!r){t.push("</li>")}return t.join("")}function S(r){var t;var s;var a;var n;var i;for(var o in r){if(!g[o]){continue}t=r[o];n=g[o];i={assetName:y.getAssetName(n.symbol),TICK_UP:t.mid>=n.LAST};i.LAST=e.copy(t.mid);e.extend(t,i);s=k(t,true);a=document.querySelectorAll("li#"+o);e.element(a).html(s)}}function w(){var e="";var r=0;function t(){e=m.children[0]||null;if(!e){return}r=e.offsetWidth;e.style.width=r+"px"}function s(){function s(){e.style.width="auto";t()}if(!r){t();return}e.style.width=Math.max(0,parseFloat(e.style.width)-c)+"px";if(parseFloat(e.style.width)<=0){m.removeChild(e);m.insertBefore(e,null);setTimeout(s,1)}}A=o(s,u)}function C(){m.style.display="block";w()}function $(e){if(!e){return}var r="";var t=[];var s;var a=[];for(var n in e){s=e[n];r=k(s);t.push(r)}a.push('<ul class="assets-long">',t.join(""),"</ul>");l.append(a.join(""));m=document.querySelector(".assets-long");C()}s.$on("$destroy",function e(){f=null;m=null;o.cancel(A)});Promise.all([i.ready(),n.instance]).then(function(e){d=e[0];y=e[1];return new Promise(function(e,r){d.assets.getPopularAssets(function s(a){var n=a.error;if(n){t.error("[API] assets.getPopularAssets returned an error:",n);return void r(n)}var i=a.data;if(!i){t.error("[API] assets.getPopularAssets returned an empty response:",a);return void r(new Error("[API] assets.getPopularAssets returned an empty response"))}var o=i.assets;if(!Array.isArray(o)||o.length<f){t.error("[API] assets.getPopularAssets returned less than %s assets: ",f,o);return void r(new Error("[API] assets.getPopularAssets returned too few assets"))}for(var u=0;u<o.length;u++){var c=o[u];g[c.symbol]=c}return void e(g)})})}).then(P).catch(function(e){t.error("assetsTickerStripDirective got an error:",e)})}return{priority:0,restrict:"A",scope:false,replace:true,templateUrl:l,link:p}}o.$inject=["$interval"];e.module("ppAssetsTickerStrip").directive("ppAssetsTickerStrip",o)})(angular,qqA);(function(e,r){"use strict";var t=r.service("config");var s="embeddablePpAssetsTickerStrip";var a="pp_assetsTickerStrip";function n(e){var r=new RegExp("^ar-");return e&&r.test(e)}function i(e,r){function s(s,a,i){var o=document.createElement("div");var u={settings:[{embeddableWidget:"true"}]};a.attr("lang",t.language);o.setAttribute("pp-assets-ticker-strip",JSON.stringify(u));o.className="embeddable";if(n(t.language)){a.addClass("rtl");a.css("direction","rtl")}function c(){e=e.$new(true);e.$parent.isParentEmbeddableDrv=true;var t=r(o)(e);a.append(t)}c()}return{priority:0,restrict:"A",scope:{},link:s}}i.$inject=["$rootScope","$compile"];e.module(s,["ppCoreModule","common","ppAssetsTickerStrip"]).directive(s,i)})(angular,qqA);