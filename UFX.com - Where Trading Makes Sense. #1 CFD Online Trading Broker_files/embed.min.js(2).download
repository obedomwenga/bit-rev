(function(e,i){"use strict";e.module("ppSpinner",[])})(angular,qqA);(function(e,i){"use strict";var t=i.service("logger");var n=i.service("template");function r(i,r){return{restrict:"A",scope:{},templateUrl:n.getTplPath("ppSpinner","main"),link:function(i,n,o){i.data=i.data||{};var a=r[0];var s,l;var c={showOverlay:false,scale:2,additionalClass:""};var g={};try{g=JSON.parse(o.ppSpinner)}catch(e){t.error("Illegal characters in Content","widgets::Spinner::directive:: Failed parsing json string ",e,o.ppSpinner);return false}l=e.extend({},c,g);i.data.scale=l.scale;i.data.additionalClass=l.additionalClass;if(l.showOverlay){s=a.createElement("div");s.classList.add("overlay");n[0].insertBefore(s,n[0].firstChild);s.style.display="none"}}}}r.$inject=["ppCore","$document"];e.module("ppSpinner",[]).directive("ppSpinner",r)})(angular,qqA);(function(e,i){"use strict";e.module("ppLogin",["ppCoreModule","ppSpinner"])})(angular,qqA);(function(e,i,t){"use strict";var n=i.service("event");var r=i.service("logger");var o=i.service("translation");var a=i.model("MarketingInfo");var s=i.service("navigation");var l=i.service("config");var c=i.service("sharedResources");var g=i.service("user");var u=i.service("gateway");function f(e,c){var f;var d;var p=new Promise(function(e,i){f=e;d=i});var m=u.ERRORS.WRONG_CREDENTIALS;var v=u.ERRORS.CLIENT_NOT_CONNECTED;var S=u.ERRORS.INSUFFICIENT_SOCIAL_PROVIDER_INFO;var E=/^[\/]{0,1}/;var w={showLoginForm:false,showSocialLogin:false,emailFocus:false,missingFieldAlert:false,wrongUserPasswordAlert:false,serviceTimeoutAlert:false,inputFocus:false,gwDisconnectedAlert:false,redirectInProgress:false};var L=i.svc("ng").getScopify(c);var T;var h;var A={email:"",password:""};var R=i.service("ng").initUnwatchers(c);var y=null;Promise.all([u.ready(),o.get("ppLogin"),s.ready()]).then(L(function(e){var i=e[0];var t=e[1];var n=e[2];c.mb={show:false,strings:{header:t.MB_PERMISSIONS_HEADER,content:"",button:t.MB_PERMISSIONS_BUTTON,footer:t.MB_PERMISSIONS_FOOTER,text:{facebook:t.MB_PERMISSIONS_TEXT_FACEBOOK,googleplus:t.MB_PERMISSIONS_TEXT_GPLUS}}};c.passwordFieldTypeTitle=t.SHOW_PASSWORD;c.resources=t;T=n.TRADING_URL;h=n.isCurrentPage(T);function r(e){c.data.regulationType=e.data&&e.data.regulationType||"DEFAULT"}i.sessionInfo.getClientRegulation(L(r));f()})).catch(function(e){r.error("ppLogin ready got an error:",e)});R.toggleLoginForm=n.on("toggleLoginForm",N);R.showLoginBox=n.on("showLoginBox",G);R.preLogin=g.preLogin(K);R.postLogin=g.postLogin(Y);R.email=c.$watch("formData.email",X);R.showLoginForm=c.$watch("flags.showLoginForm",J);R.joinWindowOn=e.$on("joinWindowOn",j);c.regulationLogo=l.regulationLogoData&&l.regulationLogoData.regulationLogo||{};c.flags=w;c.formData=A;c.passwordFieldType="password";c.passwordFieldTypeTitle="";c.resources={};c.waiting=false;c.data=c.data||{};c.initSocialProviders=B;c.signInLocal=U;c.signInFb=V;c.signInGPlus=x;c.toggleLoginForm=N;c.togglePasswordView=I;c.sendLoginInstructionsEmail=_;c.setFlag=F;c.$on("$destroy",z);c.closeSocialNotification=b;e.userData=g.user;e.classes=e.classes||{};c.userData=g.user;function P(e){var i=c.$root.$$phase;if(i==="$apply"||i==="$digest"){if(e&&typeof e==="function"){e()}}else{c.$apply(e)}}function N(e){P(function(){y=e||y;w.showLoginForm=!w.showLoginForm;n.emit(w.showLoginForm?"msgBoxOpen":"msgBoxClose");if(w.showLoginForm){w.emailFocus=true;n.emit(i.EVENTS.EXTERNAL_EVENT,i.EVENTS.THIRD_PARTY.LOGIN_FORM_VIEW)}else{b()}})}function I(){if(c.passwordFieldType==="password"){c.passwordFieldType="text";c.passwordFieldTypeTitle=c.resources.HIDE_PASSWORD}else{c.passwordFieldType="password";c.passwordFieldTypeTitle=c.resources.SHOW_PASSWORD}}function F(e,i){var t={};if(typeof e==="string"){t[e]=i}if(typeof e==="object"){t=e}for(var n in t){if(n in w){w[n]=t[n]}else{r.trace("Trying to set invalid flag %s.",e)}}}function O(){for(var e in w){w[e]=false}}function _(){function e(e){if(e.error){r.warn("UFXRegistration - sendSocialsReminderEmail returned error",e.error)}else{r.trace("UFXRegistration - sendSocialsReminderEmail succeeds");P(function(){c.data.socialReminderEmailSent=true})}}u.connector.social.triggerRecoveryEmail(c.formData.email,e)}function $(e){c.data.emailAlreadyRegisteredWith3rdParty=true;c.data.emailAssociatedWithAuthProvider=e.authProviders}function b(){c.data.emailAlreadyRegisteredWith3rdParty=false;c.data.emailAssociatedWithAuthProvider=null;c.data.socialReminderEmailSent=false}function C(e){var i;var t=document.createElement("a");t.href=e;t.hostname=l.baseHostname;i=t.pathname.replace(E,"/").split("/");i[1]=g.user.info.locale;i[2]=l.tradingPageSlugMap[g.user.info.locale];t.pathname=i.join("/");return t.href}function D(){var e={login:"true"};O();if(l.isHomePage){if(l.language!==g.user.info.locale){T=C(T)}w.redirectInProgress=true;s.redirect(T,e)}else{n.emit(i.EVENTS.EXTERNAL_EVENT,i.EVENTS.THIRD_PARTY.LOGIN)}if(y){y();y=null}}function W(){c.waiting=false}function k(){var e={ftr:g.user.isNew,login:""+!g.user.isNew};O();if(l.isHomePage){w.redirectInProgress=true;s.ready().then(function(){if(l.language!==g.user.info.locale){T=C(T)}s.redirect(T,e)})}else if(e.ftr){n.emit(i.EVENTS.EXTERNAL_EVENT,i.EVENTS.THIRD_PARTY.REGISTRATION)}else{n.emit(i.EVENTS.EXTERNAL_EVENT,i.EVENTS.THIRD_PARTY.LOGIN)}}function q(e){if(!e){e={code:null,message:""}}var i=e.code===m;if(e.status===v){F({emailFocus:true,serviceTimeoutAlert:false,wrongUserPasswordAlert:false,gwDisconnectedAlert:true});return}if(e.status==="registered_only_3rd_party"){$(e);return}F({emailFocus:true,serviceTimeoutAlert:!i,wrongUserPasswordAlert:i,gwDisconnectedAlert:false});r.trace("Login got error on login, message is:",e.message)}function M(e,i){if(!i){i={code:null,message:""}}r.trace("Login widget got error on social login, message is:",i.message);c.waiting=false;switch(i.code){case S:c.mb.strings.content=c.mb.strings.text[e];c.mb.show=true;break;case m:break;default:break}}function U(e,t){F({emailFocus:false,wrongUserPasswordAlert:false,serviceTimeoutAlert:false,missingFieldAlert:false});if(typeof e==="string"&&typeof t==="string"&&(e.length<3||t.length<1)){F({missingFieldAlert:true,emailFocus:true});return}c.waiting=true;r.trace("Login: Trying to sign in");g.login(i.AUTH.STRATEGY.LOCAL,{email:e,password:t,disableHooks:l.isHomePage}).then(L(D),L(q)).then(L(W))}function H(e){var t=new a({registrationSource:i.CLASSES.REGISTRATION_SOURCE.SITE,formType:i.CLASSES.REGISTRATION_FORM_TYPE.SOCIAL});P(function(){c.waiting=true});g.login(e,{marketingInfo:t,disableHooks:l.isHomePage}).then(L(k),L(function(i){M(e,i)}))}function V(){H("facebook")}function x(){H("googleplus")}function B(){if(!c.data.isSocialLogin){return}function e(e){if(e.social){c.flags.showSocialLogin=true;c.flags[e.name]=true}}if(!R.userStrategyRegistered){R.userStrategyRegistered=n.on(i.EVENTS.USER.STRATEGY_REGISTERED,e)}c.flags.showSocialLogin=false;t.forEach(g.strategies,e)}function G(){c.signIn()}function j(){w.showLoginForm=false}function J(i){if(i){e.$broadcast("showLoginForm")}}function X(){c.closeSocialNotification()}function Y(i){p.then(function(){if(i&&i.isAssociatedWithNew3rdParty){e.showWelcomeBackWindowForProvider=i.isAssociatedWithNew3rdParty}else if(g.user.isNew===false&&!w.redirectInProgress&&!g.user.isPractice&&(!h&&!g.user.isCookieLogin)){s.ready().then(function(){if(l.language!==g.user.info.locale){T=C(T)}s.redirect(T,{login:"true"})})}else{e.$broadcast("resumeAppFlow")}})}function K(i){p.then(function(){if(i&&i.isAssociatedWithNew3rdParty){e.showWelcomeBackWindowForProvider=i.isAssociatedWithNew3rdParty}})}function z(){}}f.$inject=["$rootScope","$scope"];e.module("ppLogin").controller("PpLoginController",f)})(angular,qqA,_);(function(e,i){"use strict";function t(e,i,t){function n(n,r,o){n.visual={transitioned:false,rotating:false};function a(){n.visual.rotating=false;n.visual.transitioned=false;n.visual.noshadow=false;t.removeClass(r,"turn-front")}function s(){n.visual.rotating=false;n.visual.noshadow=false;i.$broadcast("transitionToJoin")}function l(){if(n.visual.rotating){return}n.visual.rotating=true;n.visual.noshadow=true;s()}function c(){n.visual.rotating=true;t.addClass(r,"turn-front").then(a)}n.goToJoin=l;if(n.data.transition){n.data.transition=false;n.visual.noshadow=true;e(c,50)}}return{scope:false,link:n}}t.$inject=["$timeout","$rootScope","$animate"];e.module("ppLogin").directive("ppLoginAnimation",t)})(angular,qqA);(function(e,i){"use strict";var t=i.service("event");var n=i.service("logger");var r=i.service("template");var o=i.service("config");function a(i){function a(r,a,s){var l={};var c;var g="ppLogin";if(o.embeddable&&o.embeddedWidgetsArr.indexOf(g)>-1&&!r.$parent.isParentEmbeddableDrv){return false}function u(){r.data.transition=true;t.emit("toggleLoginForm")}r.data=r.data||{};if(i[0].location.pathname==="/login"){return}if(s.ppLogin){try{l=JSON.parse(s.ppLogin)}catch(e){n.error("Illegal characters in Content","widgets::ppLogin::directive:: Failed parsing json string ",e,s.ppLogin);return false}}else{l={settings:[]}}if(!l.settings||l.settings.length===0){n.warn("ppLogin - warn","widgets::ppLogin::directive:: no settings passed");return false}r.data.isSocialLogin=l.settings[0].isSocialLogin;if(typeof r.data.isSocialLogin==="string"){r.data.isSocialLogin=r.data.isSocialLogin==="true"}if(r.data.isSocialLogin){r.initSocialProviders()}e.element(a).find("a").attr("target","_self");c=l.settings[0];n.trace("ppLogin - got these widget settings: ",c);r.$on("transitionToLogin",u)}return{priority:0,restrict:"A",controller:"PpLoginController",scope:{redirectTo:"@redirectTo"},replace:true,templateUrl:r.getTplPath("ppLogin","main"),link:a}}a.$inject=["$document"];e.module("ppLogin").directive("ppLogin",a)})(angular,qqA);(function(e,i){"use strict";function t(e,i){function t(t,n,r){var o=i(r.focusMe);var a;function s(i){if(i){e(function(){n[0].focus()})}}function l(){t.$evalAsync(function(){o.assign(t,false)})}function c(){a();n.unbind("blur",l)}a=t.$watch(o,s);n.bind("blur",l);t.$on("$destroy",c)}return{link:t}}t.$inject=["$timeout","$parse"];e.module("ppLogin").directive("focusMe",t)})(angular,qqA);(function(e,i){"use strict";function t(){function e(e,i){var t;var n='<span ng-click="goToJoin()">$1</span>';var r=/\*([^*]+)\*/g;if(typeof i.text!=="string"||typeof i.text.replace!=="function"){return}t=i.text.replace(r,n);e.html("<p>"+t+"</p>")}return{compile:e}}e.module("ppLogin").directive("ppLoginGoToJoin",t)})(angular,qqA);(function(e,i){"use strict";var t=i.service("config");var n="embeddablePpLogin";var r="pp_login";function o(e){var i=new RegExp("^ar-");return e&&i.test(e)}function a(i,n){function r(r,a,s){var l=document.createElement("div");var c={settings:[{embeddableWidget:"true"}]};function g(){var t=document.createElement("div");t.setAttribute("tm-trigger","");n(t)(i);e.element(document.body).append(t)}a.attr("lang",t.language);l.setAttribute("pp-login",JSON.stringify(c));l.className="embeddable";if(o(t.language)){a.addClass("rtl");a.css("direction","rtl")}function u(){i=i.$new(true);var e=n(l)(i);e.scope().isParentEmbeddableDrv=true;a.append(e)}g();u()}return{priority:0,restrict:"A",scope:{},link:r}}a.$inject=["$rootScope","$compile"];e.module(n,["ppCoreModule","common","ppLogin"]).directive(n,a);try{t.regulationLogoData=JSON.parse('{"regulationLogo":{"url":"//fs.ufx.com/591a94c1017424443a14fce9.png","urlFooter":"//fs.ufx.com/591a94c1017424443a14fce9.png","title":"CySec"}}')}catch(e){logger.error(e)}})(angular,qqA);